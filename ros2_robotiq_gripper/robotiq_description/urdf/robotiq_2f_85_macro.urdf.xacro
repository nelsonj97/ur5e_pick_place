<?xml version="1.0"?>
<robot xmlns:xacro="http://wiki.ros.org/xacro">

  <xacro:macro name="robotiq_gripper"
               params="
                 name
                 prefix:=''
                 parent
                 *origin
                 sim_gazebo:=false
                 sim_ignition:=false
                 sim_isaac:=false
                 use_fake_hardware:=true
                 include_ros2_control:=true
                 com_port:=/dev/null">

    <xacro:include filename="$(find robotiq_description)/urdf/2f_85.ros2_control.xacro"/>

    <xacro:if value="${include_ros2_control}">
      <xacro:robotiq_gripper_ros2_control
        name="${name}"
        prefix="${prefix}"
        sim_ignition="${sim_ignition}"
        sim_isaac="${sim_isaac}"
        use_fake_hardware="${use_fake_hardware}"
        com_port="${com_port}" />
    </xacro:if>

  <!-- ================= LINKS ================= -->

  <link name="${prefix}robotiq_85_base_link">
    <visual>
      <geometry>
        <mesh filename="file://$(find robotiq_description)/meshes/visual/2f_85/robotiq_base.dae"/>
      </geometry>
    </visual>
    <collision>
      <geometry>
        <mesh filename="file://$(find robotiq_description)/meshes/collision/2f_85/robotiq_base.stl"/>
      </geometry>
    </collision>
    <inertial>
      <origin xyz="0 0 0.0323"/>
      <mass value="0.663"/>
      <inertia ixx="5.16e-4" iyy="5.88e-4" izz="3.95e-4"
               ixy="0" ixz="0" iyz="0"/>
    </inertial>
  </link>

  <link name="${prefix}robotiq_85_left_knuckle_link">
    <visual>
      <geometry>
        <mesh filename="file://$(find robotiq_description)/meshes/visual/2f_85/left_knuckle.dae"/>
      </geometry>
    </visual>
    <collision>
      <geometry>
        <box size="0.03 0.01 0.05"/> <!-- Simplified box collision -->
      </geometry>
    </collision>
    <inertial>
      <mass value="0.05"/>
      <inertia ixx="5e-5" iyy="5e-5" izz="5e-5" ixy="0" ixz="0" iyz="0"/>
    </inertial>
  </link>

  <link name="${prefix}robotiq_85_right_knuckle_link">
    <visual>
      <geometry>
        <mesh filename="file://$(find robotiq_description)/meshes/visual/2f_85/right_knuckle.dae"/>
      </geometry>
    </visual>
    <collision>
      <geometry>
        <box size="0.03 0.01 0.05"/> <!-- Simplified box collision -->
      </geometry>
    </collision>
    <inertial>
      <mass value="0.05"/>
      <inertia ixx="5e-5" iyy="5e-5" izz="5e-5" ixy="0" ixz="0" iyz="0"/>
    </inertial>
  </link>

  <link name="${prefix}robotiq_85_left_finger_link">
    <visual>
      <geometry>
        <mesh filename="file://$(find robotiq_description)/meshes/visual/2f_85/left_finger.dae"/>
      </geometry>
    </visual>
    <collision>
      <geometry>
        <box size="0.04 0.01 0.05"/> <!-- Simplified box collision -->
      </geometry>
    </collision>
    <inertial>
      <mass value="0.1"/>
      <inertia ixx="1e-4" iyy="1e-4" izz="1e-4" ixy="0" ixz="0" iyz="0"/>
    </inertial>
  </link>

  <link name="${prefix}robotiq_85_right_finger_link">
    <visual>
      <geometry>
        <mesh filename="file://$(find robotiq_description)/meshes/visual/2f_85/right_finger.dae"/>
      </geometry>
    </visual>
    <collision>
      <geometry>
        <box size="0.04 0.01 0.05"/> <!-- Simplified box collision -->
      </geometry>
    </collision>
    <inertial>
      <mass value="0.1"/>
      <inertia ixx="1e-4" iyy="1e-4" izz="1e-4" ixy="0" ixz="0" iyz="0"/>
    </inertial>
  </link>

  <!-- Finger tips as boxes for visibility and TF -->

  <link name="${prefix}robotiq_85_left_finger_tip_link">
    <visual>
      <geometry>
        <box size="0.012 0.010 0.020"/>
      </geometry>
    </visual>
    <collision>
      <geometry>
        <box size="0.012 0.010 0.020"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.02"/>
      <inertia ixx="1e-6" iyy="1e-6" izz="1e-6" ixy="0" ixz="0" iyz="0"/>
    </inertial>
  </link>

  <link name="${prefix}robotiq_85_right_finger_tip_link">
    <visual>
      <geometry>
        <box size="0.012 0.010 0.020"/>
      </geometry>
    </visual>
    <collision>
      <geometry>
        <box size="0.012 0.010 0.020"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.02"/>
      <inertia ixx="1e-6" iyy="1e-6" izz="1e-6" ixy="0" ixz="0" iyz="0"/>
    </inertial>
  </link>

  <!-- ================= JOINTS ================= -->

  <joint name="${prefix}robotiq_85_base_joint" type="fixed">
    <parent link="${parent}"/>
    <child link="${prefix}robotiq_85_base_link"/>
    <xacro:insert_block name="origin"/>
  </joint>

  <joint name="${prefix}robotiq_85_left_knuckle_joint" type="revolute">
    <parent link="${prefix}robotiq_85_base_link"/>
    <child link="${prefix}robotiq_85_left_knuckle_link"/>
    <origin xyz="0.0306 0 0.0549"/>
    <axis xyz="0 -1 0"/>
    <limit lower="0" upper="0.8" effort="50" velocity="0.5"/>
  </joint>

  <joint name="${prefix}robotiq_85_right_knuckle_joint" type="revolute">
    <parent link="${prefix}robotiq_85_base_link"/>
    <child link="${prefix}robotiq_85_right_knuckle_link"/>
    <origin xyz="-0.0306 0 0.0549"/>
    <axis xyz="0 -1 0"/>
    <limit lower="-0.8" upper="0" effort="50" velocity="0.5"/>
    <mimic joint="${prefix}robotiq_85_left_knuckle_joint" multiplier="-1"/>
  </joint>

  <joint name="${prefix}robotiq_85_left_finger_joint" type="fixed">
    <parent link="${prefix}robotiq_85_left_knuckle_link"/>
    <child link="${prefix}robotiq_85_left_finger_link"/>
    <origin xyz="0.0315 0 -0.0037"/>
  </joint>

  <joint name="${prefix}robotiq_85_right_finger_joint" type="fixed">
    <parent link="${prefix}robotiq_85_right_knuckle_link"/>
    <child link="${prefix}robotiq_85_right_finger_link"/>
    <origin xyz="-0.0315 0 -0.0037"/>
  </joint>

  <joint name="${prefix}robotiq_85_left_finger_tip_joint" type="fixed">
    <parent link="${prefix}robotiq_85_left_finger_link"/>
    <child link="${prefix}robotiq_85_left_finger_tip_link"/>
    <origin xyz="0.0056 0 0.0472"/>
  </joint>

  <joint name="${prefix}robotiq_85_right_finger_tip_joint" type="fixed">
    <parent link="${prefix}robotiq_85_right_finger_link"/>
    <child link="${prefix}robotiq_85_right_finger_tip_link"/>
    <origin xyz="-0.0056 0 0.0472"/>
  </joint>

  </xacro:macro>

</robot>

